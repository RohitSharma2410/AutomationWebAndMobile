
pipeline {
    agent any
  tools {
maven 'M3'
}

environment {
        COMPOSE_PROJECT_NAME = 'mytests'
    }

    stages {
        stage('Clone Repo') {
            steps {
                git 'https://github.com/your-org/your-repo.git'
            }
        }
        
      
        stage('Test') {
            steps {
                sh "mvn -D clean test"
            }
  
            post {    
               always {
                    allure includeProperties:
                     false,
                     jdk: '',
                     results: [[path: 'allure-results']]
                }            
                 
                // If Maven was able to run the tests, even if some of the test
                // failed, record the test results and archive the jar file.               
                success {
                publishHTML (target : [allowMissing: false,
 alwaysLinkToLastBuild: true,
 keepAll: true,
 reportDir: 'target/surefire-reports',
 reportFiles: 'SparkReport.html',
 reportName: 'My Reports',
 reportTitles: 'The Report'])
            }
        }
    }
}

        

        stage('Start Docker Grid + Appium') {
            steps {
                sh 'docker-compose up -d'
            }
        }

        stage('Run Tests') {
            steps {
                sh './gradlew test'  // or mvn test, or your actual command
            }
        }

        stage('Teardown') {
            steps {
                sh 'docker-compose down'
            }
        }
    }

    